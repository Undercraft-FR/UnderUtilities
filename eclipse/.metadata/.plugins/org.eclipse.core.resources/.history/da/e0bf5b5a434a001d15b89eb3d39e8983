/*     */ package net.msgaming.tab;
/*     */ import java.awt.Color;
/*     */ import java.awt.image.BufferedImage;
/*     */ import java.util.ArrayList;
/*     */ import java.util.Collections;
/*     */ import java.util.List;
/*     */ import java.util.concurrent.ConcurrentHashMap;

/*     */ import org.lwjgl.opengl.GL11;

/*     */ 
/*     */ import cpw.mods.fml.common.Mod;
/*     */ import cpw.mods.fml.common.Mod.EventHandler;
/*     */ import cpw.mods.fml.common.event.FMLInitializationEvent;
/*     */ import cpw.mods.fml.common.event.FMLPostInitializationEvent;
/*     */ import cpw.mods.fml.common.event.FMLPreInitializationEvent;
/*     */ import cpw.mods.fml.common.eventhandler.EventPriority;
/*     */ import cpw.mods.fml.common.eventhandler.SubscribeEvent;
/*     */ import net.minecraft.client.Minecraft;
/*     */ import net.minecraft.client.gui.GuiIngame;
/*     */ import net.minecraft.client.gui.GuiPlayerInfo;
/*     */ import net.minecraft.client.network.NetHandlerPlayClient;
/*     */ import net.minecraft.client.renderer.texture.DynamicTexture;
/*     */ import net.minecraft.scoreboard.ScoreObjective;
/*     */ import net.minecraft.scoreboard.ScorePlayerTeam;
/*     */ import net.minecraft.scoreboard.Team;
/*     */ import net.minecraft.util.StringUtils;
/*     */ import net.minecraftforge.client.event.RenderGameOverlayEvent;
/*     */ import net.minecraftforge.common.MinecraftForge;
/*     */ 
/*     */ 
/*     */ 
/*     */ 
/*     */ @Mod(modid = "FancyTab", name = "FancyTab", version = "1.1")
/*     */ public class Main
/*     */ {
/*  35 */   protected final Minecraft mc = Minecraft.func_71410_x();
/*  36 */   private ConcurrentHashMap<String, BufferedImage> cachedImages = new ConcurrentHashMap<String, BufferedImage>();
/*  37 */   private ConcurrentHashMap<String, DynamicTexture> cachedTextures = new ConcurrentHashMap<String, DynamicTexture>();
/*  38 */   private List<String> fetchingSkins = Collections.synchronizedList(new ArrayList<String>());
/*     */ 
/*     */   
/*     */   @EventHandler
/*     */   public void preInit(FMLPreInitializationEvent event) {
/*  43 */     ConfigHandler.init(event.getSuggestedConfigurationFile());
/*     */   }
/*     */   
/*     */   @EventHandler
/*     */   public void init(FMLInitializationEvent event) {
/*  48 */     MinecraftForge.EVENT_BUS.register(this);
/*     */   }
/*     */ 
/*     */   
/*     */   @EventHandler
/*     */   public void postInit(FMLPostInitializationEvent event) {}
/*     */ 
/*     */   
/*     */   @SubscribeEvent(priority = EventPriority.HIGH)
/*     */   public void eventHandler(RenderGameOverlayEvent.Pre event) {
/*  58 */     if (event.type == RenderGameOverlayEvent.ElementType.PLAYER_LIST) {
/*  59 */       event.setCanceled(true);
/*     */     }
/*     */     
/*  62 */     ScoreObjective scoreobjective = this.mc.field_71441_e.func_96441_U().func_96539_a(0);
/*  63 */     NetHandlerPlayClient handler = this.mc.field_71439_g.field_71174_a;
/*  64 */     int width = event.resolution.func_78326_a();
/*  65 */     int height = event.resolution.func_78328_b();
/*     */     
/*  67 */     if (this.mc.field_71474_y.field_74321_H.func_151470_d() && (!this.mc.func_71387_A() || handler.field_147303_b.size() > 1 || scoreobjective != null))
/*     */     {
/*  69 */       if (event.type == RenderGameOverlayEvent.ElementType.TEXT) {
/*     */         
/*  71 */         if (event.type == RenderGameOverlayEvent.ElementType.PLAYER_LIST) {
/*  72 */           event.setCanceled(true);
/*     */         }
/*     */         
/*  75 */         this.mc.field_71424_I.func_76320_a("playerList");
/*  76 */         ArrayList<GuiPlayerInfo> players = new ArrayList(handler.field_147303_b);
/*  77 */         int columns = ConfigHandler.playersInARow;
/*  78 */         int playersPerPage = 120;
/*  79 */         int columnWidth = 400 / columns;
/*  80 */         int columnHeight = 18;
/*  81 */         int left = (width - columns * columnWidth) / 2;
/*  82 */         int border = 20;
/*  83 */         int currentPage = 0;
/*  84 */         GL11.glPushMatrix();
/*  85 */         GL11.glDisable(2929);
/*  86 */         GuiIngame.func_73734_a(left, 0, left + columnWidth * columns - 1, 19, -2147483648);
/*  87 */         for (int i = 0; i < players.size(); i++) {
/*  88 */           int cellPtr = i - currentPage * 120;
/*  89 */           int xPos = left + cellPtr % columns * columnWidth;
/*  90 */           int yPos = 20 + cellPtr / columns * 18;
/*  91 */           if (i < players.size()) {
/*  92 */             GuiIngame.func_73734_a(xPos, yPos, xPos + columnWidth - 1, yPos + 18 - 1, (new Color(158, 152, 152, 100)).getRGB());
/*  93 */             GuiPlayerInfo player = players.get(i);
/*  94 */             String playerName = player.field_78831_a;
/*  95 */             ScorePlayerTeam team = this.mc.field_71441_e.func_96441_U().func_96509_i(playerName);
/*  96 */             String[] displayName = ScorePlayerTeam.func_96667_a((Team)team, playerName).replaceAll("&", "§").split(" ");
/*  97 */             String name = (displayName.length == 1) ? displayName[0] : displayName[1];
/*  98 */             String prefix = (displayName.length > 1) ? displayName[0] : "";
/*  99 */             int strWidthName = this.mc.field_71466_p.func_78256_a(name.replaceAll("§.", "")) / 2;
/* 100 */             int strWidthPrefix = this.mc.field_71466_p.func_78256_a(prefix.replaceAll("§.", "")) / 2;
/* 101 */             this.mc.field_71466_p.func_78276_b(name, (columnWidth + 18) / 2 - strWidthName + xPos - 2, yPos + 5, 16777215);
/* 102 */             if (bindFace(StringUtils.func_76338_a(playerName))) {
/* 103 */               RenderUtil.drawImage(xPos, yPos, 17, 17);
/*     */             }
/*     */           } 
/*     */         } 
/*     */         
/* 108 */         int yPosOnline = (int)Math.ceil(players.size() / columns) * 18 + 20;
/*     */         
/* 110 */         GuiIngame.func_73734_a(left, yPosOnline, left + columnWidth * columns - 1, yPosOnline + 19, -2147483648);
/*     */         
/* 112 */         this.mc.field_71456_v.func_73732_a(this.mc.field_71466_p, ConfigHandler.tabHeader.replace('&', '§').replace("%online%", String.valueOf(players.size())).replace("%maxplayers%", String.valueOf(handler.field_147304_c)), width / 2, 6, -1);
/* 113 */         this.mc.field_71456_v.func_73732_a(this.mc.field_71466_p, ConfigHandler.tabFooter.replace('&', '§').replace("%online%", String.valueOf(players.size())).replace("%maxplayers%", String.valueOf(handler.field_147304_c)), width / 2, yPosOnline + 6, -1);
/* 114 */         GL11.glPopMatrix();
/* 115 */         GL11.glEnable(2929);
/*     */       } 
/*     */     }
/*     */   }
/*     */ 
/*     */ 
/*     */ 
/*     */   
/*     */   protected void renderPlayerList(int width, int height) {}
/*     */ 
/*     */ 
/*     */   
/*     */   private boolean bindFace(String username) {
/* 128 */     if (this.fetchingSkins.contains(username)) {
/* 129 */       if (this.cachedImages.containsKey(username)) {
/* 130 */         DynamicTexture faceTex = new DynamicTexture(this.cachedImages.get(username));
/* 131 */         this.cachedTextures.put(username, faceTex);
/* 132 */         this.cachedImages.remove(username);
/*     */       } 
/* 134 */       return false;
/*     */     } 
/* 136 */     if (!this.cachedTextures.containsKey(username)) {
/* 137 */       this.fetchingSkins.add(username);
/* 138 */       (new Thread(new SkinLoader(username, this.cachedImages, this.fetchingSkins))).start();
/* 139 */       return false;
/*     */     } 
/* 141 */     GL11.glBindTexture(3553, ((DynamicTexture)this.cachedTextures.get(username)).func_110552_b());
/* 142 */     GL11.glColor4f(1.0F, 1.0F, 1.0F, 1.0F);
/* 143 */     return true;
/*     */   }
/*     */ }


/* Location:              C:\Users\Admin\Downloads\FancyTab-1.1.jar!\net\msgaming\tab\Main.class
 * Java compiler version: 6 (50.0)
 * JD-Core Version:       1.1.3
 */