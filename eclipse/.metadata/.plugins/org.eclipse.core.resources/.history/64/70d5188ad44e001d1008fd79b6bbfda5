package fr.skhr.loyto.UnderUtilities.common;

import java.awt.Graphics;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.net.URL;
import java.util.HashMap;

import javax.imageio.ImageIO;

import cpw.mods.fml.common.FMLCommonHandler;
import cpw.mods.fml.common.Mod;
import cpw.mods.fml.common.Mod.EventHandler;
import cpw.mods.fml.common.Mod.Instance;
import cpw.mods.fml.common.SidedProxy;
import cpw.mods.fml.common.event.FMLInitializationEvent;
import cpw.mods.fml.common.event.FMLPostInitializationEvent;
import cpw.mods.fml.common.event.FMLPreInitializationEvent;
import cpw.mods.fml.common.eventhandler.EventPriority;
import cpw.mods.fml.common.eventhandler.SubscribeEvent;
import cpw.mods.fml.common.network.NetworkRegistry;
import cpw.mods.fml.common.network.simpleimpl.SimpleNetworkWrapper;
import cpw.mods.fml.relauncher.Side;
import fr.skhr.loyto.UnderUtilities.proxy.CommonProxy;
import net.minecraftforge.client.event.RenderGameOverlayEvent;
import net.minecraftforge.common.MinecraftForge;
import net.minecraftforge.common.config.Configuration;

@Mod(modid = "UnderUtilities", name = "UnderUtilities", version = "1.0.0")
public class UnderUtilities {
	public static final String MODID = "UnderUtilities";
	
	@SidedProxy(clientSide = "fr.skhr.loyto.UnderUtilities.proxy.ClientProxy", serverSide = "fr.skhr.loyto.UnderUtilities.proxy.CommonProxy")
	public static CommonProxy proxy;
	
	@Instance("modtutoriel")
    public static UnderUtilities instance;
	
	//Default tab header-footer
	public static String header = "Voici le Header";
	public static String footer = "Voici le Footer";
	public static BufferedImage test = null;
	
	//Network
	public static SimpleNetworkWrapper network;
	
	@EventHandler
    public void preInit(FMLPreInitializationEvent event)
    {
		//Configuration
		Configuration cfg = new Configuration(event.getSuggestedConfigurationFile());
		try
		{
		    cfg.load();
		}
		catch(Exception ex)
		{
		    System.out.println("[SKHR-Tab] Impossible de charger le fichier de configuration");
		}
		finally
		{
		    if(cfg.hasChanged())
		    {
		        cfg.save();
		    }
		}

		footer = cfg.get("tab" , "footer", footer).getString();
		header = cfg.get("tab" , "header", header).getString();
		cfg.save();
		
		//Network
		network = NetworkRegistry.INSTANCE.newSimpleChannel(MODID);
		network.registerMessage(serverMessage.Handler.class, serverMessage.class, 0, Side.CLIENT);
		
		SSLUtilities.trustAllHostnames();
		SSLUtilities.trustAllHttpsCertificates();
    }

    @EventHandler
    public void init(FMLInitializationEvent event)
    {
    	proxy.registerRender();
    	//MinecraftForge.EVENT_BUS.register(this);
    	
    	FMLCommonHandler.instance().bus().register(new UnderUtilitiesEventHandler());
        MinecraftForge.EVENT_BUS.register(new UnderUtilitiesEventHandler());
    }
    	
    @EventHandler
    public void postInit(FMLPostInitializationEvent event)
    {
		try {
			URL url = new URL("https://www.undercraft.fr/api/skin-api/skins/Loyto");
			BufferedImage t = ImageIO.read(url.openStream());
			
			test = new BufferedImage(64, 32, 2);
			BufferedImage face = t.getSubimage(0, 0, 64, 32);
			Graphics g = test.getGraphics();
			g.drawImage(face, 0, 0, null);
		} catch (IOException e) {
			e.printStackTrace();
		}
    }
}
